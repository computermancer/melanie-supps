<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Support Guide App</title>
  <script>
    // Simple service worker registration with debug info
    if ('serviceWorker' in navigator) {
      // Unregister any existing service workers first
      navigator.serviceWorker.getRegistrations().then(registrations => {
        for (let registration of registrations) {
          console.log('Unregistering service worker:', registration.scope);
          registration.unregister();
        }
        
        // Clear all caches
        if ('caches' in window) {
          caches.keys().then(cacheNames => {
            cacheNames.forEach(cacheName => {
              console.log('Deleting cache:', cacheName);
              caches.delete(cacheName);
            });
            
            // Register the service worker after cleanup
            registerServiceWorker();
          });
        } else {
          registerServiceWorker();
        }
      }).catch(err => {
        console.error('Error during service worker cleanup:', err);
        registerServiceWorker();
      });
    }
    
    function registerServiceWorker() {
      navigator.serviceWorker.register('/sw.js')
        .then(registration => {
          console.log('ServiceWorker registration successful with scope:', registration.scope);
          
          // Force the waiting service worker to become active
          if (registration.waiting) {
            registration.waiting.postMessage({ type: 'SKIP_WAITING' });
          }
          
          // Refresh the page when the new service worker is activated
          let refreshing = false;
          navigator.serviceWorker.addEventListener('controllerchange', () => {
            if (!refreshing) {
              console.log('Controller changed, reloading...');
              refreshing = true;
              window.location.reload();
            }
          });
          
          // Check for updates every minute (for testing)
          setInterval(() => registration.update(), 60000);
        })
        .catch(err => {
          console.error('ServiceWorker registration failed:', err);
        });
    }
  </script>
  <script type="module" src="/main.jsx"></script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100">
  <div id="root"></div>
</body>
</html>